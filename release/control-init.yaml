package_update: true
packages:
  - conntrack
users:
  - default
disable_root: false
ssh_authorized_keys:
  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvW2dRLu0PLQeQ5q5X76RaPvh8/lhhTzucdOizgzJfbUClve4KVCivtB1/S0rX6uuZL6TZhtRDrB1bVGAkwnt6zTT/irQ1ly1AseLAGIdA+03ikQ4gD1hL+MPURko4O9qWyDpBzPtjinRkXYTPdDe3g5jj1CZMI8uw+oOwdxf/9efeEfiQZ+pZuqgtEJttxWx3NrLqiyZhiciSVoRxyXkOltMdovzNeeeRB0KkFKhjSWhjTW0QRJ19ZsDtH3lxChQd7YFfTtYL0oe3ZkRINzHwfr1vzTVaolWTF70H4LWFaTZpmFWZ+WmmXNriUHwov2TBsCYRMAJkM72PAi8WmtWR calico@cloud
ca_certs:
  trusted:
    - registry_ca_crt
    - |
      -----BEGIN CERTIFICATE-----
      MIIDWzCCAkOgAwIBAgIUKDQUbNak3zHQpb/BGR5SuQSzJH8wDQYJKoZIhvcNAQEL
      BQAwPTEVMBMGA1UEAwwMcHJpdmF0ZS1yZXBvMRcwFQYDVQQKDA5XZSBsb3ZlIENh
      bGljbzELMAkGA1UEBhMCVVMwHhcNMjQwNTE4MDQwNzAyWhcNMjcwMzA4MDQwNzAy
      WjA9MRUwEwYDVQQDDAxwcml2YXRlLXJlcG8xFzAVBgNVBAoMDldlIGxvdmUgQ2Fs
      aWNvMQswCQYDVQQGEwJVUzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB
      ALEDYkPqVywQ5SbZQPSe2ocQRhQrrU6f4XA49EINF17FPRtltDi/50TYFCOi/nMP
      FeJfVM2Z6nTvfPPCw4FF+JWNxeYBCsl1Eienl+QULweD4PFiu7qNNlTnJF95PqB6
      U2sEBVO2xbiNrpjKHA9povi5GmUt0Eeppx9eEMaPCmrtpjGSxsie+mxPPBXylut6
      DaYBSy/NjmTi91n1QCl2/C+BGF78XHtThqKCpmm/OZqzcJLnGcpdtNTNMKmU+h83
      rnCtG46CcBJet6LSoRb2topwthK6foCjtseSIVvAZWyFhsao8uCTGjhe2WSNTYxN
      Wgq+FHu43xOTnySOZ2VSjmkCAwEAAaNTMFEwHQYDVR0OBBYEFFfICHZ0cBIw4Mso
      qdz86zwUvlkRMB8GA1UdIwQYMBaAFFfICHZ0cBIw4Msoqdz86zwUvlkRMA8GA1Ud
      EwEB/wQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEBAKdfpAe6GZ/XfNaIRxXmrtyv
      CbaNaA9INkl5DL+ey3S01cnm7KVetjlrnLGsa+belWuuISPoRmtBBX7dSg9Qce4Q
      22OpDRTgRXku8weYI/CGyOkxKBJztUz+EhMofl4QOD1qcIvMj+wYuKIhYP1zvR3M
      h8I6L9MNz1nirTITO1Bznwid/aabICsB/TcFbJO/NGWN0TDXUo0RCYixkCtjZavm
      jrihs2P0nzMLnCSl22LuLpKwjm/iIcmLLedF1jpFceWgTItSxsKmnpJtQmz2SJcO
      RZsD+zNVW/H8rlK1LV5KRaac1lHfnEBI8HDvycRvB+xu7u+1HsMQ+5Evjq/K9wA=
      -----END CERTIFICATE-----
write_files:
- encoding: b64
  content: IyEvYmluL2Jhc2gKI0szU19WRVJTSU9OPSJ2MS4yMy4xNiUyQmszczEiCiNLM1NfVkVSU0lPTj0idjEuMjUuOCUyQmszczEiCkszU19WRVJTSU9OPSQxCgpBUkNIPWB1bmFtZSAtbWAKaWYgW1sgJEFSQ0ggPT0gIng4Nl82NCIgXV0KdGhlbgplY2hvICJEb3dubG9hZGluZyBrM3MgYmluYXJ5IGZvciAkQVJDSCIKL3Vzci9iaW4vY3VybCAtTCBodHRwczovL2dpdGh1Yi5jb20vazNzLWlvL2szcy9yZWxlYXNlcy9kb3dubG9hZC8kSzNTX1ZFUlNJT04vazNzIC1vIC91c3IvbG9jYWwvYmluL2szcwplY2hvICJEb3dubG9hZGluZyBjYWxpY29jdGwgYmluYXJ5ICRBUkNIIgovdXNyL2Jpbi9jdXJsIC1MIGh0dHBzOi8vZ2l0aHViLmNvbS9wcm9qZWN0Y2FsaWNvL2NhbGljby9yZWxlYXNlcy9sYXRlc3QvZG93bmxvYWQvY2FsaWNvY3RsLWxpbnV4LWFtZDY0IC1vIC91c3IvbG9jYWwvYmluL2NhbGljb2N0bAplbHNlCmVjaG8gIkRvd25sb2FkaW5nIGszcyBiaW5hcnkgZm9yICRBUkNIIgovdXNyL2Jpbi9jdXJsIC1MIGh0dHBzOi8vZ2l0aHViLmNvbS9rM3MtaW8vazNzL3JlbGVhc2VzL2Rvd25sb2FkLyRLM1NfVkVSU0lPTi9rM3MtYXJtNjQgLW8gL3Vzci9sb2NhbC9iaW4vazNzCmVjaG8gIkRvd25sb2FkaW5nIGNhbGljb2N0bCBiaW5hcnkgJEFSQ0giCi91c3IvYmluL2N1cmwgLUwgaHR0cHM6Ly9naXRodWIuY29tL3Byb2plY3RjYWxpY28vY2FsaWNvL3JlbGVhc2VzL2xhdGVzdC9kb3dubG9hZC9jYWxpY29jdGwtbGludXgtYXJtNjQgLW8gL3Vzci9sb2NhbC9iaW4vY2FsaWNvY3RsCmZpCgovdXNyL2Jpbi9jaG1vZCAreCAvdXNyL2xvY2FsL2Jpbi9rM3MKL3Vzci9iaW4vY2htb2QgK3ggL3Vzci9sb2NhbC9iaW4vY2FsaWNvY3RsIAoKL3Vzci9iaW4vY3VybCBodHRwczovL2dldC5rM3MuaW8vID4gL3Jvb3QvaW5zdGFsbC5zaAovdXNyL2Jpbi9jaG1vZCAreCAvcm9vdC9pbnN0YWxsLnNoCgojIE1hYyBPUyBkaXNjb3ZlcnkgZml4CmNhdCA+PiAvZXRjL3N5c3RlbWQvcmVzb2x2ZWQuY29uZiA8PC1FT0YKTXVsdGljYXN0RE5TPXllcwpEb21haW5zPW11bHRpcGFzcyBtc2hvbWUubmV0IGxvY2FsCkVPRgovdXNyL2Jpbi9zeXN0ZW1jdGwgZW5hYmxlIHN5c3RlbWQtcmVzb2x2ZWQuc2VydmljZQovdXNyL2Jpbi9zeXN0ZW1jdGwgcmVzdGFydCBzeXN0ZW1kLXJlc29sdmVkLnNlcnZpY2UKCmNhdCA+IC9ldGMvc3lzdGVtZC9zeXN0ZW0vbWRuc0Auc2VydmljZSA8PC1FT0YKW1NlcnZpY2VdClR5cGU9b25lc2hvdApFeGVjU3RhcnQ9L3Vzci9iaW4vcmVzb2x2ZWN0bCBtZG5zICVpIHllcwpBZnRlcj1zeXMtc3Vic3lzdGVtLW5ldC1kZXZpY2VzLSVpLmRldmljZQoKW0luc3RhbGxdCldhbnRlZEJ5PXN5cy1zdWJzeXN0ZW0tbmV0LWRldmljZXMtJWkuZGV2aWNlCkVPRgoKSU5URVJGQUNFPWBpcCBsaW5rIHNob3cgIHwgZWdyZXAgIlswLTldOiBlbiIgfCBhd2sgJ3sgcHJpbnQgJDIgfScgfCBjdXQgLWQ6IC1mMWAKCi91c3IvYmluL3N5c3RlbWN0bCBlbmFibGUgbWRuc0AkSU5URVJGQUNFLnNlcnZpY2UKL3Vzci9iaW4vc3lzdGVtY3RsIHN0YXJ0IG1kbnNAJElOVEVSRkFDRS5zZXJ2aWNlCiMgTWFjIE9TIGRpc2NvdmVyeSBmaXgK
  owner: root:root
  path: /root/prepare.sh
- encoding: b64
  content: IyEvYmluL2Jhc2gKCkNMVVNURVJfQ0lEUj0kMQpTRVJWSUNFX0NJRFI9JDIKQ0xVU1RFUl9ETlM9JDMKSzNTX0ZFQVRVUkVTPSQ0CkRJU0FCTEVfS1VCRV9QUk9YWT0kNQojIEluY3JlYXNlIHBvZC1jb3VudApjYXQgPj4gIC9ldGMva3ViZWxldC5jb25mIDw8LUVPRgphcGlWZXJzaW9uOiBrdWJlbGV0LmNvbmZpZy5rOHMuaW8vdjFiZXRhMQpraW5kOiBLdWJlbGV0Q29uZmlndXJhdGlvbgptYXhQb2RzOiA0MDAwCkVPRgojIEluY3JlYXNlIHBvZC1jb3VudAoKSU5TVEFMTF9LM1NfU0tJUF9ET1dOTE9BRD10cnVlIEszU19LVUJFQ09ORklHX01PREU9IjY0NCIgSU5TVEFMTF9LM1NfRVhFQz0iLS1rdWJlbGV0LWFyZz1jb25maWc9L2V0Yy9rdWJlbGV0LmNvbmYgLS1mbGFubmVsLWJhY2tlbmQ9bm9uZSAtLWNsdXN0ZXItY2lkcj0kQ0xVU1RFUl9DSURSIC0tc2VydmljZS1jaWRyPSRTRVJWSUNFX0NJRFIgLS1jbHVzdGVyLWRucz0kQ0xVU1RFUl9ETlMgLS1kaXNhYmxlLW5ldHdvcmstcG9saWN5ICRESVNBQkxFX0tVQkVfUFJPWFkgLS1kaXNhYmxlPSRLM1NfRkVBVFVSRVMiIC9yb290L2luc3RhbGwuc2gK
  owner: root:root
  path: /root/control.sh

runcmd:
  - [ /usr/bin/chmod, +x, /root/prepare.sh ]
  - [ /root/prepare.sh, "v1.28.9%2Bk3s1" ]
  - [ /usr/bin/chmod, +x, /root/control.sh ]
  - [ /root/control.sh, "172.16.0.0/16", "10.43.0.0/16", "10.43.0.10", "traefik,local-storage,metrics-server", "" ]
  - [ /usr/bin/chown, -R, ubuntu:ubuntu, /home/ubuntu ]
  - [ /usr/bin/systemctl, enable, k3s.service ]

power_state:
  mode: reboot
