package_update: true
packages:
  - docker-registry
  - docker.io
users:
  - default
write_files:
- encoding: b64
  content: IyEvYmluL2Jhc2gKI0szU19WRVJTSU9OPSJ2MS4yMy4xNiUyQmszczEiCiNLM1NfVkVSU0lPTj0idjEuMjUuOCUyQmszczEiCkszU19WRVJTSU9OPSQxCgpBUkNIPWB1bmFtZSAtbWAKaWYgW1sgJEFSQ0ggPT0gIng4Nl82NCIgXV0KdGhlbgplY2hvICJEb3dubG9hZGluZyBrM3MgYmluYXJ5IGZvciAkQVJDSCIKL3Vzci9iaW4vY3VybCAtTCBodHRwczovL2dpdGh1Yi5jb20vazNzLWlvL2szcy9yZWxlYXNlcy9kb3dubG9hZC8kSzNTX1ZFUlNJT04vazNzIC1vIC91c3IvbG9jYWwvYmluL2szcwplY2hvICJEb3dubG9hZGluZyBjYWxpY29jdGwgYmluYXJ5ICRBUkNIIgovdXNyL2Jpbi9jdXJsIC1MIGh0dHBzOi8vZ2l0aHViLmNvbS9wcm9qZWN0Y2FsaWNvL2NhbGljby9yZWxlYXNlcy9sYXRlc3QvZG93bmxvYWQvY2FsaWNvY3RsLWxpbnV4LWFtZDY0IC1vIC91c3IvbG9jYWwvYmluL2NhbGljb2N0bAplbHNlCmVjaG8gIkRvd25sb2FkaW5nIGszcyBiaW5hcnkgZm9yICRBUkNIIgovdXNyL2Jpbi9jdXJsIC1MIGh0dHBzOi8vZ2l0aHViLmNvbS9rM3MtaW8vazNzL3JlbGVhc2VzL2Rvd25sb2FkLyRLM1NfVkVSU0lPTi9rM3MtYXJtNjQgLW8gL3Vzci9sb2NhbC9iaW4vazNzCmVjaG8gIkRvd25sb2FkaW5nIGNhbGljb2N0bCBiaW5hcnkgJEFSQ0giCi91c3IvYmluL2N1cmwgLUwgaHR0cHM6Ly9naXRodWIuY29tL3Byb2plY3RjYWxpY28vY2FsaWNvL3JlbGVhc2VzL2xhdGVzdC9kb3dubG9hZC9jYWxpY29jdGwtbGludXgtYXJtNjQgLW8gL3Vzci9sb2NhbC9iaW4vY2FsaWNvY3RsCmZpCgovdXNyL2Jpbi9jaG1vZCAreCAvdXNyL2xvY2FsL2Jpbi9rM3MKL3Vzci9iaW4vY2htb2QgK3ggL3Vzci9sb2NhbC9iaW4vY2FsaWNvY3RsIAoKL3Vzci9iaW4vY3VybCBodHRwczovL2dldC5rM3MuaW8vID4gL3Jvb3QvaW5zdGFsbC5zaAovdXNyL2Jpbi9jaG1vZCAreCAvcm9vdC9pbnN0YWxsLnNoCgojIE1hYyBPUyBkaXNjb3ZlcnkgZml4CmNhdCA+PiAvZXRjL3N5c3RlbWQvcmVzb2x2ZWQuY29uZiA8PC1FT0YKTXVsdGljYXN0RE5TPXllcwpEb21haW5zPW11bHRpcGFzcyBtc2hvbWUubmV0IGxvY2FsCkVPRgovdXNyL2Jpbi9zeXN0ZW1jdGwgZW5hYmxlIHN5c3RlbWQtcmVzb2x2ZWQuc2VydmljZQovdXNyL2Jpbi9zeXN0ZW1jdGwgcmVzdGFydCBzeXN0ZW1kLXJlc29sdmVkLnNlcnZpY2UKCmNhdCA+IC9ldGMvc3lzdGVtZC9zeXN0ZW0vbWRuc0Auc2VydmljZSA8PC1FT0YKW1NlcnZpY2VdClR5cGU9b25lc2hvdApFeGVjU3RhcnQ9L3Vzci9iaW4vcmVzb2x2ZWN0bCBtZG5zICVpIHllcwpBZnRlcj1zeXMtc3Vic3lzdGVtLW5ldC1kZXZpY2VzLSVpLmRldmljZQoKW0luc3RhbGxdCldhbnRlZEJ5PXN5cy1zdWJzeXN0ZW0tbmV0LWRldmljZXMtJWkuZGV2aWNlCkVPRgoKSU5URVJGQUNFPWBpcCBsaW5rIHNob3cgIHwgZWdyZXAgIlswLTldOiBlbiIgfCBhd2sgJ3sgcHJpbnQgJDIgfScgfCBjdXQgLWQ6IC1mMWAKCi91c3IvYmluL3N5c3RlbWN0bCBlbmFibGUgbWRuc0AkSU5URVJGQUNFLnNlcnZpY2UKL3Vzci9iaW4vc3lzdGVtY3RsIHN0YXJ0IG1kbnNAJElOVEVSRkFDRS5zZXJ2aWNlCiMgTWFjIE9TIGRpc2NvdmVyeSBmaXgK
  owner: root:root
  path: /root/prepare.sh
- encoding: b64
  content: dmVyc2lvbjogMC4xCmxvZzoKICBmaWVsZHM6CiAgICBzZXJ2aWNlOiByZWdpc3RyeQpzdG9yYWdlOgogIGNhY2hlOgogICAgYmxvYmRlc2NyaXB0b3I6IGlubWVtb3J5CiAgZmlsZXN5c3RlbToKICAgIHJvb3RkaXJlY3Rvcnk6IC92YXIvbGliL2RvY2tlci1yZWdpc3RyeQogIGRlbGV0ZToKICAgIGVuYWJsZWQ6IHRydWUKaHR0cDoKICBhZGRyOiAwLjAuMC4wOjUwMDAKICBoZWFkZXJzOgogICAgWC1Db250ZW50LVR5cGUtT3B0aW9uczogW25vc25pZmZdCiAgdGxzOgogICAgY2VydGlmaWNhdGU6IC9ldGMvZG9ja2VyL3JlZ2lzdHJ5L2NhLmNydAogICAga2V5OiAvZXRjL2RvY2tlci9yZWdpc3RyeS9jYS5rZXkKaGVhbHRoOgogIHN0b3JhZ2Vkcml2ZXI6CiAgICBlbmFibGVkOiB0cnVlCiAgICBpbnRlcnZhbDogMTBzCiAgICB0aHJlc2hvbGQ6IDMK
  owner: root:root
  path: /etc/docker/registry/config.yml
- encoding: b64
  content: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUR6RENDQXJTZ0F3SUJBZ0lVY3pvaHBBTjZXNk9vQ0ZENkorVUZLa3ZseXpzd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1BURVZNQk1HQTFVRUF3d01jSEpwZG1GMFpTMXlaWEJ2TVJjd0ZRWURWUVFLREE1WFpTQnNiM1psSUVOaApiR2xqYnpFTE1Ba0dBMVVFQmhNQ1ZWTXdIaGNOTWpRd05URTRNRFF3TnpFMFdoY05NamN3TXpBNE1EUXdOekUwCldqQTlNUlV3RXdZRFZRUUREQXh3Y21sMllYUmxMWEpsY0c4eEZ6QVZCZ05WQkFvTURsZGxJR3h2ZG1VZ1EyRnMKYVdOdk1Rc3dDUVlEVlFRR0V3SlZVekNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQgpBS3VLdkhzelJwZ254eVJiOHdKdlB3MEpsSGk5OGxXcFFvNm9kYklTTElGa2lQM01sZlc1RHROK29rUXFRZVpkCkdoR2RUSzVGTVFVa3NTaEV3NUJwU3dEcjdoWnhnTlhhNVJWUEQ5YjVaQjIwclkwaGV5bm1SRDRhZmRtTERZUlEKNFloSE1IUHJLMHh1eXBPdEljT2xzNkdsWms2Wi9uU3NXaGJOQnQwVXVwRVN0TVFEZ1ZGUkpXNkYxRVRrOVR1YQp1WCtWaEdKR21VMWhFZkpkemw2OXZyd2Vad0FzcWpYNnNGbUpSSUlad0JXREZQczRUOS9IQ1BTdnMrWU8yaE5vCkR3SnVpQnJNQ3ZTSlFLUDFwajNUcEx3OVZHTXplb0RkLzhsNVhTUW9PQjlZaHFXVWZpODl5Z3pmS0c2Y2ZqZDIKT0ZPUnVWYXQ2OVB6L2dBdlE2MWlMUXNDQXdFQUFhT0J3ekNCd0RBTEJnTlZIUThFQkFNQ0JEQXdFd1lEVlIwbApCQXd3Q2dZSUt3WUJCUVVIQXdFd1hBWURWUjBSQkZVd1U0SVdjSEpwZG1GMFpTMXlaWEJ2TG0xMWJIUnBjR0Z6CmM0SVhjSEpwZG1GMFpTMXlaWEJ2TG0xemFHOXRaUzV1WlhTQ0VuQnlhWFpoZEdVdGNtVndieTVzYjJOaGJJSU0KY0hKcGRtRjBaUzF5WlhCdk1CMEdBMVVkRGdRV0JCUTNEU1pPQU4vM1labk1uK01zMXl1Mzc4OGVaREFmQmdOVgpIU01FR0RBV2dCUlh5QWgyZEhBU01PRExLS25jL09zOEZMNVpFVEFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBCkFLQllXQnpZWldIRFY4NWhBVjBYdnU4d2pkTFhNbE9wSXFmcGV1a0laMUV3Q2o0TDc0MVFsWmdxdm5xNUJnRGgKeWh1YzUyaXRRV2Z2TlMxODc4bVFSUkU0dGtud2hxWnBHcnJMazZweGdDMlNJM3RpeEtQREc5bnd1cHU0azRUdgpObkxjNEk3QThteHcrdU9KVE42YTVlcm5rR3IzNTZmT3F5UzEzZHZ0OFhIZDM0ell2T3d3MkQwajN1MnZYRUh1CjRBeUU5QzZvYWtJYU5hVzNEQ0dqemQxOWF2QjV2RFNtd3UxNlYwTTQvekZqb3hrakU4eEliMmQxdUdSaFhVclkKRHJDUDhVOVBmWlFWTDQzYThZbHdWUThnWVBPZi91SUdYZDNJRUN4bk1zdmRBMjIwQytZUUlFQ0FUUW1tK0poTQplemlsVWlDN083UFNjMkMydUdJbjlnPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  owner: root:root
  path: /etc/docker/registry/ca.crt
- encoding: b64
  content: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRQ3Jpcng3TTBhWUo4Y2sKVy9NQ2J6OE5DWlI0dmZKVnFVS09xSFd5RWl5QlpJajl6SlgxdVE3VGZxSkVLa0htWFJvUm5VeXVSVEVGSkxFbwpSTU9RYVVzQTYrNFdjWURWMnVVVlR3L1crV1FkdEsyTklYc3A1a1ErR24zWml3MkVVT0dJUnpCejZ5dE1ic3FUCnJTSERwYk9ocFdaT21mNTByRm9XelFiZEZMcVJFclRFQTRGUlVTVnVoZFJFNVBVN21ybC9sWVJpUnBsTllSSHkKWGM1ZXZiNjhIbWNBTEtvMStyQlppVVNDR2NBVmd4VDdPRS9meHdqMHI3UG1EdG9UYUE4Q2JvZ2F6QXIwaVVDago5YVk5MDZTOFBWUmpNM3FBM2YvSmVWMGtLRGdmV0lhbGxINHZQY29NM3lodW5INDNkamhUa2JsV3JldlQ4LzRBCkwwT3RZaTBMQWdNQkFBRUNnZ0VBSWZJMWRFZmtXMjNidWJVOGRLbmhGMHBqQ0RYR2crOFh6YlZHZlRPZGZRbVIKRm5CcTZKSnpmYVRjcFpLYk1lUVFxWld3Ty9oVFNBcEh5SWs3RGhQWUZObWJadk9WSkR6S0FwcC9ydkh4UHZPbgpPSHQ4clFEMVZqalYyTHZzczlkeG1nOUVabHdPV0hUQVA5TU9FSEoxQnJMOWVPWitkVVk2R2JMKy9iY0JhSDJ3CmxxR1F5ak1IUk9yQ21nWDd6T3gzek9uN0Y3bFVRWW4xSDlRRlZBeFdYRVFoTkgyVmd1L3pISUNBMkRObGVJVDEKMzg4dDlpc1dnOCtIcDFWQUpMeS9yQ2RVWGV5b0xUUjRpWHZrZElWeXJYUjl1VUFOZFdCNlpDQUJoOGFTc0pBbgpwNWMwbmFsanZNU21EVVdDcjlYT1JZbmJ0VnkxdXpqOFlBbWRpVVhTQ1FLQmdRRHRLYTl1aGcrYmY1NHo5QTkyClJFd2lidWQ3MWY2VHJVRjl3UmxPaHUwcjNsM2tZQml4My9xVmJnZStQaTlGbGVaTkU5VXdvUFV1aDJkT005Z2sKdjlMbU5vNFN3Z0ovYm81Z1NaamFkRGxaOXlzaGw4SFQ3WS9yMnRtKzNKNDNXeWpNbkxYSUJ3TEFhM3JQSFY0cgpoeFVuK3VKeW5TaEwyNGx2V2llL1pNaGJyUUtCZ1FDNUtzSW0wSGlHQVpQaHJWZEVIL0h3VzhyZlc1TnlVQ2VvCnI2ZnNiWkJ6dnJ0VVNPU3h0OGU2Z1AvMzFPKzNSeGNPL1dwUHpDSUtkRzExYVZGdEQ1VW11Y2FXNnlKeS9YTWQKTU0xNE9QbGtlTzdYZHpodWxnZkFROFYzS1FvcFhoanhjcmNjTzJyTWpiNWlQYnJXL3NZMDBXaDhhVlVWZXZCSApteWMwOUFmQ2x3S0JnUURoZ2IyYUxrY3c2SXdaZ253aFRKZklOZ1JPTUJDOWd3UysrcG1CbmJKdkFDWHZQYUM5Cm9lZTNwc1FlRlNzRjA1OEVzMU1IeGtUY1ZVdlpoRnFGdHhCbWJvRnhQS0Q3WXJobXZoUmx4QlcwZ2QyMU40UEsKYkIxcGV0T0pOR1lNNU5WS21jZ1B4dnJLMUdnV0FDckc0TTh4RU5HNWdjNExNMWpmVks1dXd2bndrUUtCZ0QvKwpzUjh0Q1pwMnpSOUFBMXIrRjJYVXM2YkNSWkZLZG9wc093TVJVczFONi94VFBRYlcxMlp6MHdOYVNvYnpRTnJqClpteXh4a29LdHhIUEZsODA5WDF1MDEyeFlqU1B0OHNzNUxaYUtvYzQ3SUwzSnovQkJtakNnMnFOZW4rVmo5VlMKcWtwTmxybWZlMThFcXFCSGFVVXo0b0tzL01UeHVqMWxPQVdyR1V0OUFvR0JBTE9Vbm4zanNwbjduK0dvL0dNMgpzMVNOZ3V0eTI5ekNUTG5zbVVVRTRuNUhVNmhZSXBpY3hJcWlvL24yVVE1VXROM3hKbkJZdnBCMmNrc1FRMWFRCnFJRjlNdTJpcEtIRUJPeFdIQlV6S0ZoY1A1WTQzc25kdzJzSk1CQm1vd3IxeTh0eTdueG9GRmpVQzJzVVJlVFUKNG9RVHBLQ1VCeUptMUFoVEVvcXMwa3M1Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
  owner: root:root
  path: /etc/docker/registry/ca.key

disable_root: false
ssh_authorized_keys:
  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvW2dRLu0PLQeQ5q5X76RaPvh8/lhhTzucdOizgzJfbUClve4KVCivtB1/S0rX6uuZL6TZhtRDrB1bVGAkwnt6zTT/irQ1ly1AseLAGIdA+03ikQ4gD1hL+MPURko4O9qWyDpBzPtjinRkXYTPdDe3g5jj1CZMI8uw+oOwdxf/9efeEfiQZ+pZuqgtEJttxWx3NrLqiyZhiciSVoRxyXkOltMdovzNeeeRB0KkFKhjSWhjTW0QRJ19ZsDtH3lxChQd7YFfTtYL0oe3ZkRINzHwfr1vzTVaolWTF70H4LWFaTZpmFWZ+WmmXNriUHwov2TBsCYRMAJkM72PAi8WmtWR calico@cloud
runcmd:
  - [ /usr/bin/chmod, +x, /root/prepare.sh ]
  - [ /root/prepare.sh ]
  - [ /usr/sbin/usermod -aG docker ubuntu ]
  - [ /usr/bin/systemctl, enable, docker.service ]
  - [ /usr/bin/systemctl, enable, docker-registry.service ]
